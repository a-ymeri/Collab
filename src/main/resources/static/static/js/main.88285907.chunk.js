(this["webpackJsonpcollab-editor-ts"]=this["webpackJsonpcollab-editor-ts"]||[]).push([[0],{100:function(e,t,n){},169:function(e,t,n){"use strict";n.r(t);var c=n(4),r=n(0),o=n.n(r),i=n(42),s=n.n(i),a=(n(100),n(1)),f=n(2),l=n(49),u=n(86),j=n(87),b=n.n(j),h=0,d=Date.now();console.log(d);var p=new Map,O=[],x=[],g=[],m=[],v=function(){var e=Object(r.useRef)(new b.a("http://127.0.0.1:8080/collab-editor")),t=Object(r.useRef)(u.over(e.current)),n=Object(r.useMemo)((function(){return Object(l.c)(Object(f.h)())}),[]),o=Object(r.useRef)(!1),i=Object(r.useRef)(!1),s=Object(r.useState)([{type:"paragraph",children:[{text:""}]}]),j=Object(a.a)(s,2),v=j[0],D=j[1];function I(e){if(e.siteID!==d){var t;if(console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID),e.offset>=0)for(var c=0;c<x.length;c++){if(t=_(e),-1===(e=S(e,x[c])).offset){x.splice(c,1);break}x[c]=S(x[c],t)}x.forEach((function(e,t){x[t].stateID++})),e.offset>=0&&(o.current=!0,n.apply(e),O.push(e),o.current=!1,h++,console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID))}else x.forEach((function(e,t){x[t].stateID++})),x.splice(0,1),g.splice(0,1),i.current=!1,x.length>0&&y(x[0]),h++,O.push(e)}function y(e){i.current||(i.current=!0,setTimeout((function(){t.current.send("/app/sendcharacter",{},JSON.stringify(e))}),0))}return Object(r.useEffect)((function(){t.current.connected||t.current.connect({},(function(){var e=window.location.href.split("/").pop();t.current.subscribe("/app/file/"+e,(function(e){var t=JSON.parse(e.body).body;D([{type:"paragraph",children:[{text:t.text}]}]),h=Number(t.state)})),t.current.subscribe("/topic/1",(function(e){var t=JSON.parse(e.body);I(t),m.push(t)}))}))}),[]),Object(r.useEffect)((function(){console.log(v[0].children[0].text)}),[v]),Object(c.jsxs)("div",{children:[Object(c.jsx)(l.b,{editor:n,value:v,onChange:function(e){D(e),n.operations.filter((function(e){return!!e&&("remove_text"===e.type||"insert_text"===e.type)})).forEach((function(e){e.siteID||(e.siteID=d,e.stateID=h,x.push(e),g.push(e),console.log("Local change:"+v[0].children[0].text),console.log("offset: "+e.offset+"| character: "+e.text+"| stateID: "+e.stateID),y(e))}))},children:Object(c.jsx)(l.a,{onKeyDown:function(e){}})}),Object(c.jsx)("button",{onClick:function(){x.length>0&&y(x[0])},children:"Send"}),Object(c.jsx)("button",{onClick:function(){m.length>0&&I(m.splice(0,1)[0])},children:"Receive"})]});function S(e,t){var n=function(e,t){var n={siteID:e.siteID,stateID:e.stateID},c={siteID:t.siteID,stateID:t.stateID};if(p.get(n)===c)return-1;if(p.get(c)===n)return 1;var r=1;e.offset<t.offset?(r=-1,p.set(n,c)):e.offset===t.offset&&("insert_text"===e.type&&"insert_text"===t.type&&e.siteID<t.siteID?(r=-1,p.set(n,c)):"remove_text"===e.type&&"remove_text"===t.type?r=0:"insert_text"===e.type&&"remove_text"===t.type&&(r=-1,p.set(n,c)));return r}(e,t),c=_(e);return 0===n?c.offset=-1:1===n&&("insert_text"===t.type?c.offset++:c.offset--),c}function _(e){return JSON.parse(JSON.stringify(e))}},D=n(37),I=n(10),y=n(91),S=n.n(y),_=n(189),w=n(193),N=n(196),E=n(197),C=n(191),J=n(194),R=n(195),k=n(192),F=Object(_.a)({table:{minWidth:650}}),M=[];function L(e){var t=e.data,n=F();return console.log(t.length),console.log(t),M=t||[],Object(c.jsx)(C.a,{component:k.a,children:Object(c.jsxs)(w.a,{className:n.table,"aria-label":"simple table",children:[Object(c.jsx)(J.a,{children:Object(c.jsxs)(R.a,{children:[Object(c.jsx)(E.a,{align:"right",children:"Name"}),Object(c.jsx)(E.a,{align:"right",children:"Owner"}),Object(c.jsx)(E.a,{align:"right",children:"Last Modified"}),Object(c.jsx)(E.a,{align:"right",children:"File Size"})]})}),Object(c.jsx)(N.a,{children:M.map((function(e,t){return Object(c.jsxs)(R.a,{children:[Object(c.jsx)(E.a,{align:"right",children:Object(c.jsxs)(D.b,{to:"/doc/"+e.id,children:[e.name," "]})}),Object(c.jsx)(E.a,{align:"right",children:e.owner}),Object(c.jsx)(E.a,{align:"right",children:e.last_modified}),Object(c.jsx)(E.a,{align:"right",children:e.file_size})]},e.name+t)}))})]})})}var T=function(){var e=Object(r.useState)([]),t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){S.a.get("http://localhost:8080/api/doc").then((function(e){o(e.data)}))}),[]),Object(c.jsxs)("div",{children:["DOCUMENTS",Object(c.jsx)(L,{data:n})]})},z=n(58),B=n(92);function P(e){e.component;var t=Object(B.a)(e,["component"]);return Object(c.jsx)(I.b,Object(z.a)(Object(z.a)({},t),{},{render:function(e){return Object(c.jsx)(I.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}var K=function(){return Object(c.jsx)("p",{children:" hello "})},U=function(){return Object(c.jsx)(D.a,{children:Object(c.jsxs)(I.d,{children:[Object(c.jsx)(P,{path:"/",exact:!0,component:T}),Object(c.jsx)(I.b,{path:"/login",component:K}),Object(c.jsx)(P,{path:"/doc",component:v})]})})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,199)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),o(e),i(e)}))};s.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(U,{})}),document.getElementById("root")),W()}},[[169,1,2]]]);
//# sourceMappingURL=main.88285907.chunk.js.map