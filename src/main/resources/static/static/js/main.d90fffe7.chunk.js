(this["webpackJsonpcollab-editor-ts"]=this["webpackJsonpcollab-editor-ts"]||[]).push([[0],{167:function(e,t,n){"use strict";n.r(t);var c=n(5),r=n(0),i=n.n(r),s=n(41),o=n.n(s),a=(n(98),n(1)),f=n(2),l=n(49),u=n(85),j=n(86),h=n.n(j),b=0,d=Date.now();console.log(d);var p=new Map,O=[],x=[],g=[],D=[],v=function(){var e=Object(r.useRef)(new h.a("http://127.0.0.1:8080/collab-editor")),t=Object(r.useRef)(u.over(e.current)),n=Object(r.useMemo)((function(){return Object(l.c)(Object(f.h)())}),[]),i=Object(r.useRef)(!1),s=Object(r.useRef)(!1),o=Object(r.useState)([{type:"paragraph",children:[{text:""}]}]),j=Object(a.a)(o,2),v=j[0],I=j[1];function m(e){if(e.siteID!==d){var t;if(console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID),e.offset>=0)for(var c=0;c<x.length;c++){if(t=_(e),-1===(e=S(e,x[c])).offset){x.splice(c,1);break}x[c]=S(x[c],t)}x.forEach((function(e,t){x[t].stateID++})),e.offset>=0&&(i.current=!0,n.apply(e),O.push(e),i.current=!1,b++,console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID))}else x.forEach((function(e,t){x[t].stateID++})),x.splice(0,1),g.splice(0,1),s.current=!1,x.length>0&&y(x[0]),b++,O.push(e)}function y(e){s.current||(s.current=!0,setTimeout((function(){t.current.send("/app/sendcharacter",{},JSON.stringify(e))}),0))}return Object(r.useEffect)((function(){t.current.connected||t.current.connect({},(function(){var e=window.location.href.split("/").pop();t.current.subscribe("/app/file/"+e,(function(e){var t=JSON.parse(e.body).body;I([{type:"paragraph",children:[{text:t.text}]}]),b=Number(t.state)})),t.current.subscribe("/topic/1",(function(e){var t=JSON.parse(e.body);m(t),D.push(t)}))}))}),[]),Object(r.useEffect)((function(){console.log(v[0].children[0].text)}),[v]),Object(c.jsxs)("div",{children:[Object(c.jsx)(l.b,{editor:n,value:v,onChange:function(e){I(e),n.operations.filter((function(e){return!!e&&("remove_text"===e.type||"insert_text"===e.type)})).forEach((function(e){e.siteID||(e.siteID=d,e.stateID=b,x.push(e),g.push(e),console.log("Local change:"+v[0].children[0].text),console.log("offset: "+e.offset+"| character: "+e.text+"| stateID: "+e.stateID),y(e))}))},children:Object(c.jsx)(l.a,{onKeyDown:function(e){}})}),Object(c.jsx)("button",{onClick:function(){x.length>0&&y(x[0])},children:"Send"}),Object(c.jsx)("button",{onClick:function(){D.length>0&&m(D.splice(0,1)[0])},children:"Receive"})]});function S(e,t){var n=function(e,t){var n={siteID:e.siteID,stateID:e.stateID},c={siteID:t.siteID,stateID:t.stateID};if(p.get(n)===c)return-1;if(p.get(c)===n)return 1;var r=1;e.offset<t.offset?(r=-1,p.set(n,c)):e.offset===t.offset&&("insert_text"===e.type&&"insert_text"===t.type&&e.siteID<t.siteID?(r=-1,p.set(n,c)):"remove_text"===e.type&&"remove_text"===t.type?r=0:"insert_text"===e.type&&"remove_text"===t.type&&(r=-1,p.set(n,c)));return r}(e,t),c=_(e);return 0===n?c.offset=-1:1===n&&("insert_text"===t.type?c.offset++:c.offset--),c}function _(e){return JSON.parse(JSON.stringify(e))}},I=n(45),m=n(10),y=n(90),S=n.n(y),_=n(187),w=n(191),N=n(194),E=n(195),C=n(189),J=n(192),R=n(193),k=n(190),F=Object(_.a)({table:{minWidth:650}}),M=[];function L(e){var t=e.data,n=F();return console.log(t.length),M=t,Object(c.jsx)(C.a,{component:k.a,children:Object(c.jsxs)(w.a,{className:n.table,"aria-label":"simple table",children:[Object(c.jsx)(J.a,{children:Object(c.jsxs)(R.a,{children:[Object(c.jsx)(E.a,{align:"right",children:"Name"}),Object(c.jsx)(E.a,{align:"right",children:"Owner"}),Object(c.jsx)(E.a,{align:"right",children:"Last Modified"}),Object(c.jsx)(E.a,{align:"right",children:"File Size"})]})}),Object(c.jsx)(N.a,{children:M.map((function(e,t){return Object(c.jsxs)(R.a,{children:[Object(c.jsx)(E.a,{align:"right",children:Object(c.jsxs)(I.b,{to:"/doc/"+e.id,children:[e.name," "]})}),Object(c.jsx)(E.a,{align:"right",children:e.owner}),Object(c.jsx)(E.a,{align:"right",children:e.last_modified}),Object(c.jsx)(E.a,{align:"right",children:e.file_size})]},e.name+t)}))})]})})}var T=function(){var e=Object(r.useState)([]),t=Object(a.a)(e,2),n=t[0],i=t[1];return Object(r.useEffect)((function(){S.a.get("http://localhost:8080/api/docs/1").then((function(e){i(e.data)}))}),[]),Object(c.jsxs)("div",{children:["DOCUMENTS",Object(c.jsx)(L,{data:n})]})},z=function(){return Object(c.jsx)(I.a,{children:Object(c.jsxs)(m.c,{children:[Object(c.jsx)(m.a,{path:"/",exact:!0,component:T}),Object(c.jsx)(m.a,{path:"/doc",component:v})]})})},B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,197)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),c(e),r(e),i(e),s(e)}))};o.a.render(Object(c.jsx)(i.a.StrictMode,{children:Object(c.jsx)(z,{})}),document.getElementById("root")),B()},98:function(e,t,n){}},[[167,1,2]]]);
//# sourceMappingURL=main.d90fffe7.chunk.js.map