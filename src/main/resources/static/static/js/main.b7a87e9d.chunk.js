(this["webpackJsonpcollab-editor-ts"]=this["webpackJsonpcollab-editor-ts"]||[]).push([[0],{102:function(e,t,n){},172:function(e,t,n){},173:function(e,t,n){"use strict";n.r(t);var c=n(4),s=n(0),r=n.n(s),o=n(43),a=n.n(o),i=(n(102),n(1)),l=n(2),u=n(51),f=n(89),j=n(90),b=n.n(j),h=0,d=Date.now();console.log(d);var p=new Map,O=[],x=[],g=[],m=[],v=function(){var e=Object(s.useRef)(new b.a("http://127.0.0.1:8080/collab-editor")),t=Object(s.useRef)(f.over(e.current)),n=Object(s.useMemo)((function(){return Object(u.c)(Object(l.h)())}),[]),r=Object(s.useRef)(!1),o=Object(s.useRef)(!1),a=Object(s.useState)([{type:"paragraph",children:[{text:""}]}]),j=Object(i.a)(a,2),v=j[0],y=j[1];function D(e){if(e.siteID!==d){var t;if(console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID),e.offset>=0)for(var c=0;c<x.length;c++){if(t=N(e),-1===(e=w(e,x[c])).offset){x.splice(c,1);break}x[c]=w(x[c],t)}x.forEach((function(e,t){x[t].stateID++})),e.offset>=0&&(r.current=!0,n.apply(e),O.push(e),r.current=!1,h++,console.log("Remote execution of: character:"+e.text+" | offset:"+e.offset+" | stateID: "+e.stateID))}else x.forEach((function(e,t){x[t].stateID++})),x.splice(0,1),g.splice(0,1),o.current=!1,x.length>0&&I(x[0]),h++,O.push(e)}function I(e){o.current||(o.current=!0,setTimeout((function(){t.current.send("/app/sendcharacter",{},JSON.stringify(e))}),0))}return Object(s.useEffect)((function(){t.current.connected||t.current.connect({},(function(){var e=window.location.href.split("/").pop();t.current.subscribe("/app/file/"+e,(function(e){var t=JSON.parse(e.body).body;y([{type:"paragraph",children:[{text:t.text}]}]),h=Number(t.state)})),t.current.subscribe("/topic/1",(function(e){var t=JSON.parse(e.body);D(t),m.push(t)}))}))}),[]),Object(s.useEffect)((function(){console.log(v[0].children[0].text)}),[v]),Object(c.jsxs)("div",{children:[Object(c.jsx)(u.b,{editor:n,value:v,onChange:function(e){y(e),n.operations.filter((function(e){return!!e&&("remove_text"===e.type||"insert_text"===e.type)})).forEach((function(e){e.siteID||(e.siteID=d,e.stateID=h,x.push(e),g.push(e),console.log("Local change:"+v[0].children[0].text),console.log("offset: "+e.offset+"| character: "+e.text+"| stateID: "+e.stateID),I(e))}))},children:Object(c.jsx)(u.a,{onKeyDown:function(e){}})}),Object(c.jsx)("button",{onClick:function(){x.length>0&&I(x[0])},children:"Send"}),Object(c.jsx)("button",{onClick:function(){m.length>0&&D(m.splice(0,1)[0])},children:"Receive"})]});function w(e,t){var n=function(e,t){var n={siteID:e.siteID,stateID:e.stateID},c={siteID:t.siteID,stateID:t.stateID};if(p.get(n)===c)return-1;if(p.get(c)===n)return 1;var s=1;e.offset<t.offset?(s=-1,p.set(n,c)):e.offset===t.offset&&("insert_text"===e.type&&"insert_text"===t.type&&e.siteID<t.siteID?(s=-1,p.set(n,c)):"remove_text"===e.type&&"remove_text"===t.type?s=0:"insert_text"===e.type&&"remove_text"===t.type&&(s=-1,p.set(n,c)));return s}(e,t),c=N(e);return 0===n?c.offset=-1:1===n&&("insert_text"===t.type?c.offset++:c.offset--),c}function N(e){return JSON.parse(JSON.stringify(e))}},y=n(38),D=n(10),I=n(44),w=n.n(I),N=n(193),S=n(197),_=n(200),E=n(202),C=n(195),F=n(198),J=n(199),R=n(196),k=Object(N.a)({table:{minWidth:650}}),M=[];function P(e){var t=e.data,n=k();return console.log(t.length),console.log(t),M=t||[],Object(c.jsx)(C.a,{component:R.a,children:Object(c.jsxs)(S.a,{className:n.table,"aria-label":"simple table",children:[Object(c.jsx)(F.a,{children:Object(c.jsxs)(J.a,{children:[Object(c.jsx)(E.a,{align:"right",children:"Name"}),Object(c.jsx)(E.a,{align:"right",children:"Owner"}),Object(c.jsx)(E.a,{align:"right",children:"Last Modified"}),Object(c.jsx)(E.a,{align:"right",children:"File Size"})]})}),Object(c.jsx)(_.a,{children:M.map((function(e,t){return Object(c.jsxs)(J.a,{children:[Object(c.jsx)(E.a,{align:"right",children:Object(c.jsxs)(y.b,{to:"/doc/"+e.id,children:[e.name," "]})}),Object(c.jsx)(E.a,{align:"right",children:e.owner}),Object(c.jsx)(E.a,{align:"right",children:e.last_modified}),Object(c.jsx)(E.a,{align:"right",children:e.file_size})]},e.name+t)}))})]})})}var B=n(201),L=function(){var e=new B.a,t=Object(s.useState)([]),n=Object(i.a)(t,2),r=n[0],o=n[1];return Object(s.useEffect)((function(){w.a.get("http://localhost:8080/api/doc",{headers:{Authorization:e.get("auth")}}).then((function(e){o(e.data)}))}),[]),Object(c.jsxs)("div",{children:["DOCUMENTS",Object(c.jsx)(P,{data:r})]})},T=n(60),z=n(94);function U(e){var t=e.component,n=Object(z.a)(e,["component"]),s=!!(new B.a).get("auth");return Object(c.jsx)(D.b,Object(T.a)(Object(T.a)({},n),{},{render:function(e){return!0===s?Object(c.jsx)(t,{}):Object(c.jsx)(D.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}n(171),n(172);var q=function(){var e=new B.a;return Object(c.jsx)("div",{children:Object(c.jsx)("div",{className:"container",children:Object(c.jsxs)("form",{className:"form-signin",onSubmit:function(t){t.preventDefault(),function(){var t={username:document.getElementById("username").value,password:document.getElementById("password").value};w.a.post("http://localhost:8080/login",t).then((function(t){console.log("auth success"),console.log(t),e.set("auth",t.data,{maxAge:1800}),window.location.replace("/")})).catch((function(e){401===e.response.status&&console.log("redirect to login with bad creds")}))}()},children:[Object(c.jsx)("h2",{className:"form-signin-heading",children:"Please sign in"}),Object(c.jsxs)("p",{children:[Object(c.jsx)("label",{htmlFor:"username",className:"sr-only",children:"Username"}),Object(c.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control",placeholder:"Username",required:!0})]}),Object(c.jsxs)("p",{children:[Object(c.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),Object(c.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",placeholder:"Password",required:!0})]}),Object(c.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"})]})})})},A=function(){return Object(c.jsx)(y.a,{children:Object(c.jsxs)(D.d,{children:[Object(c.jsx)(U,{path:"/",exact:!0,component:L}),Object(c.jsx)(D.b,{path:"/login",component:q}),Object(c.jsx)(U,{path:"/doc",component:v}),Object(c.jsx)(D.b,{render:function(){return Object(c.jsx)(D.a,{to:{pathname:"/login"}})}})]})})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,204)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),c(e),s(e),r(e),o(e)}))};a.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(A,{})}),document.getElementById("root")),K()}},[[173,1,2]]]);
//# sourceMappingURL=main.b7a87e9d.chunk.js.map