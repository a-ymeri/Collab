(this["webpackJsonpcollab-editor-ts"]=this["webpackJsonpcollab-editor-ts"]||[]).push([[0],{107:function(t,e,n){"use strict";n.r(e);var o=n(8),c=n(2),s=n.n(c),r=n(24),i=n.n(r),f=(n(61),n(0)),a=n(1),u=n(26),l=n(51),p=n(52),h=new(n.n(p).a)("http://127.0.0.1:8080/collab-editor"),b=l.over(h),d=0,x=Date.now();console.log(x);var g=new Map,j=[],D=[],I=[],O=[],v=function(){var t=Object(c.useMemo)((function(){return Object(u.c)(Object(a.h)())}),[]),e=Object(c.useRef)(!1),n=Object(c.useRef)(!1),s=Object(c.useState)([{type:"paragraph",children:[{text:""}]}]),r=Object(f.a)(s,2),i=r[0],l=r[1];function p(o){if(o.siteID!==x){var c;if(console.log("Remote execution of: character:"+o.text+" | offset:"+o.offset+" | stateID: "+o.stateID),o.offset>=0)for(var s=0;s<D.length;s++){if(c=y(o),-1===(o=v(o,D[s])).offset){D.splice(s,1);break}D[s]=v(D[s],c)}D.forEach((function(t,e){D[e].stateID++})),o.offset>=0&&(e.current=!0,t.apply(o),j.push(o),e.current=!1,d++,console.log("Remote execution of: character:"+o.text+" | offset:"+o.offset+" | stateID: "+o.stateID))}else D.forEach((function(t,e){D[e].stateID++})),D.splice(0,1),I.splice(0,1),n.current=!1,D.length>0&&h(D[0]),d++,j.push(o)}function h(t){n.current||(n.current=!0,setTimeout((function(){b.send("/app/sendcharacter",{},JSON.stringify(t))}),1500))}return Object(c.useEffect)((function(){b.connected||b.connect({},(function(){b.subscribe("/app/file/1/getDocument",(function(t){l([{type:"paragraph",children:[{text:JSON.parse(t.body).text}]}]),d=Number(JSON.parse(t.body).state)})),b.subscribe("/topic/1",(function(t){var e=JSON.parse(t.body);p(e),O.push(e)}))}))}),[]),Object(c.useEffect)((function(){console.log(i[0].children[0].text)}),[i]),Object(o.jsxs)("div",{children:[Object(o.jsx)(u.b,{editor:t,value:i,onChange:function(e){l(e),t.operations.filter((function(t){return!!t&&("remove_text"===t.type||"insert_text"===t.type)})).forEach((function(t){t.siteID||(t.siteID=x,t.stateID=d,D.push(t),I.push(t),console.log("Local change:"+i[0].children[0].text),console.log("offset: "+t.offset+"| character: "+t.text+"| stateID: "+t.stateID),h(t))}))},children:Object(o.jsx)(u.a,{onKeyDown:function(t){}})}),Object(o.jsx)("button",{onClick:function(){D.length>0&&h(D[0])},children:"Send"}),Object(o.jsx)("button",{onClick:function(){O.length>0&&p(O.splice(0,1)[0])},children:"Receive"})]});function v(t,e){var n=function(t,e){var n={siteID:t.siteID,stateID:t.stateID},o={siteID:e.siteID,stateID:e.stateID};if(g.get(n)===o)return-1;if(g.get(o)===n)return 1;var c=1;t.offset<e.offset?(c=-1,g.set(n,o)):t.offset===e.offset&&("insert_text"===t.type&&"insert_text"===e.type&&t.siteID<e.siteID?(c=-1,g.set(n,o)):"remove_text"===t.type&&"remove_text"===e.type?c=0:"insert_text"===t.type&&"remove_text"===e.type&&(c=-1,g.set(n,o)));return c}(t,e),o=y(t);return 0===n?o.offset=-1:1===n&&("insert_text"===e.type?o.offset++:o.offset--),o}function y(t){return JSON.parse(JSON.stringify(t))}},y=function(){return console.log(["ab","a/c","ad"].length),Object(o.jsx)("div",{children:Object(o.jsx)(v,{})})},m=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,108)).then((function(e){var n=e.getCLS,o=e.getFID,c=e.getFCP,s=e.getLCP,r=e.getTTFB;n(t),o(t),c(t),s(t),r(t)}))};i.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(y,{})}),document.getElementById("root")),m()},61:function(t,e,n){}},[[107,1,2]]]);
//# sourceMappingURL=main.496283e3.chunk.js.map